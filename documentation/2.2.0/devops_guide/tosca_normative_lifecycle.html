
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-73216650-1', 'auto');
ga('set', {
  page: '/documentation/2.2.0/devops_guide/tosca_normative_lifecycle.html',
  title: 'Normative Lifecycle'
});
ga('send', 'pageview');

</script>

<div class="container-fluid">
  <div class="row">
    
      <div class="col-sm-4 col-md-3">
        <div id="sidebar_menu" class="tree" role="complementary"></div>
      </div>
      <div id="content" class="col-sm-8 col-md-9">
    
        <div style="height: 50px;">
          <h1 class="pull-left" style="margin-top: 0px;">Normative Lifecycle</h1>
          <a class="btn btn-primary pull-right" href="http://prose.io/#alien4cloud/alien4cloud.github.io/edit/sources/documentation/2.2.0/devops_guide/tosca_normative_lifecycle.md"><i class="fa fa-pencil-square-o"></i> Edit (pull request)</a>
        </div>
        <p>TOSCA normative lifecycle is automatically generated by the TOSCA container based on the normative node and relationship types.</p>

<hr style="margin-top:5px; margin-bottom:5px;" />
<div class="row"><ul class="nav nav-pills" id="summarypanel"></ul></div>
<hr style="margin-top:5px; margin-bottom:5px;" />

<div class="note">
<p>Note that the TOSCA specification on lifecycle is still being written so this may be subject to changes before v1 release.</p>
</div>

<p>Lifecycle is based on the normative node interface (tosca.interfaces.node.lifecycle.Standard) and relationship interface (tosca.interfaces.relationship.Configure).</p>

<h1 id="node-lifecycle-generation">Node Lifecycle generation</h1>

<ol>
  <li>wait for all node that is a target of a <strong><em>DependsOn</em></strong> relationship to reach the <strong><em>started</em></strong> state (current node being source of the relationship).</li>
  <li>call the node’s <strong><em>create</em></strong> operation</li>
  <li>call the relationships <strong><em>pre_configure_source</em></strong> (if the node is the relationship source) or <strong><em>pre_configure_target</em></strong> (if the node is the relationship target)</li>
  <li>call the node’s <strong><em>configure</em></strong> operation</li>
  <li>call the relationships <strong><em>post_configure_source</em></strong> (if the node is the relationship source) or <strong><em>post_configure_target</em></strong> (if the node is the relationship target)</li>
  <li>call the node’s <strong><em>start</em></strong> operation</li>
  <li>call the relationships <strong><em>add_target</em></strong> (on the nodes sources) and <strong><em>add_source</em></strong> (on the nodes targets) operations.</li>
</ol>

<h1 id="environment-variables">Environment Variables</h1>

<p>When operation scripts are called, some environment variables are filled by the script caller.</p>

<h3 id="node-operation">Node operation</h3>

<p>For node operation script, the following variables are available:</p>

<ul>
  <li><code>NODE</code>: the node name.</li>
  <li><code>INSTANCE</code>: the unique instance ID.</li>
  <li><code>INSTANCES</code>: A comma separated list of all available instance IDs.</li>
  <li><code>HOST</code>: the node name of the node that host the current one.</li>
</ul>

<div class="note info">
<h5> Additionnal environment variables </h5>
<p>In addition, the folowing variables are also available:
  - <strong>Inputs parameters</strong>: All inputs parameters defined on the operation definiton
  - <strong>Properties</strong>: All the properties of the node and its capabilities are available following the naming:
     * <code>SELF_&lt;PROPERTY_NAME&gt;</code> for node properties
     * <code>SELF_CAPABILITIES_&lt;CAPABILITY_NAME&gt;_&lt;PROPERTY_NAME&gt;</code> for capabilities properties</p>
</div>

<h3 id="relationship-operation">Relationship operation</h3>

<p>For relationship operation script, the following variables are available:</p>

<ul>
  <li><code>TARGET_NODE</code>: The node name that is targeted by the relationship.</li>
  <li><code>TARGET_INSTANCE</code>: The instance ID that is targeted by the relatonship.</li>
  <li><code>TARGET_INSTANCES</code>: Comma separated list of all available instance IDs for the target node.</li>
  <li><code>SOURCE_NODE</code>: The node name that is the source of the relationship.</li>
  <li><code>SOURCE_INSTANCE</code>: The instance ID of the source of the relationship.</li>
  <li><code>SOURCE_INSTANCES</code>: Comma separated list of all available source instance IDs.</li>
</ul>

<div class="note info">
<h5> Additionnal environment variables </h5>
<p>In addition, the folowing variables are also available:
  - <strong>Inputs parameters</strong>: All inputs parameters defined on the operation definiton
  - <strong>Properties</strong>: All the properties of the involved nodes and capabilities are available following the naming:
     * <code>SELF_&lt;PROPERTY_NAME&gt;</code> for relationship properties
     * <code>SOURCE_&lt;PROPERTY_NAME&gt;</code> for source node properties
     * <code>TARGET_&lt;PROPERTY_NAME&gt;</code> for target node properties
     * <code>TARGET_CAPABILITIES_&lt;CAPABILITY_NAME&gt;_&lt;PROPERTY_NAME&gt;</code> for targeted capability property</p>
</div>

<h3 id="attribute-and-multiple-instances">Attribute and multiple instances</h3>

<p>When an operation defines an input, the value is available by fetching an environment variable.
If you have multiple instances, you’ll be able to fetch the input value for all instances by prefixing the inpu name by the instance ID.</p>

<p>Let’s imagine you have an relationship’s configure interface operation defined like this:</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">add_target</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">inputs</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">TARGET_IP</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">get_attribute</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">TARGET</span><span class="p-Indicator">,</span> <span class="nv">ip_address</span><span class="p-Indicator">]</span> <span class="p-Indicator">}</span>
  <span class="l-Scalar-Plain">implementation</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">scripts/add_target.sh</span></code></pre></div>

<p>Let’s imagine we have a node named <code>MyNodeS</code> with 2 instances: <code>MyNodeS_1</code>, <code>MyNodeS_2</code>.
The node <code>MyNodeS</code> is connected to the target node <code>MyNodeT</code> which has also 2 instances <code>MyNodeT_1</code> and <code>MyNodeT_2</code>.</p>

<p>When the <code>add_target.sh</code> script is executed for the relationship instance that connects <code>MyNodeS_1</code> to <code>MyNodeT_1</code>, the following variables will be available:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">TARGET_NODE</span><span class="o">=</span>MyNodeT
<span class="nv">TARGET_INSTANCE</span><span class="o">=</span>MyNodeT_1
<span class="nv">TARGET_INSTANCES</span><span class="o">=</span>MyNodeT_1,MyNodeT_2
<span class="nv">SOURCE_NODE</span><span class="o">=</span>MyNodeS
<span class="nv">SOURCE_INSTANCE</span><span class="o">=</span>MyNodeS_1
<span class="nv">SOURCE_INSTANCES</span><span class="o">=</span>MyNodeS_1,MyNodeS_2
<span class="nv">TARGET_IP</span><span class="o">=</span>192.168.0.11
<span class="nv">MyNodeT_1_TARGET_IP</span><span class="o">=</span>192.168.0.11
<span class="nv">MyNodeT_2_TARGET_IP</span><span class="o">=</span>192.168.0.12</code></pre></div>

<div class="note info">
<h5>More infos</h5>
<p>In our samples you can find a topology <a href="https://github.com/alien4cloud/samples/tree/master/demo-lifecycle">demo-lifecycle</a> that clearly demonstrate all this behavior.
Once deployed, you can find out ALL runtime available environment varibales for the different lifecycle scripts.</p>
</div>

        <a class="btn btn-primary pull-right" href="http://prose.io/#alien4cloud/alien4cloud.github.io/edit/sources/documentation/2.2.0/devops_guide/tosca_normative_lifecycle.md"><i class="fa fa-pencil-square-o"></i> Edit (pull request)</a>
	  </div>
    </div>
  </div>
</div><!-- /container -->

<script>
var hash = location.hash.replace( /^#/, '' );
if(hash && hash!== null && hash.match(/html$/)) {
} else {
  var newLocation = location.protocol+"//"+location.host+"#"+location.pathname;
  location.replace(newLocation);
}
</script>
<script type="text/javascript" src="/js/post-layout.js"></script>
<script>
$(document).ready(function () {
  makeSideBar('DOCUMENTATION-2.2.0', 'documentation/2.2.0/devops_guide/tosca_normative_lifecycle.md');
});
</script>

<script>
$("div[data-gist]").gist();
</script>
